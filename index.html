<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÙˆÙ‚ Ø§Ù„ØªØ¬Ø§Ø± Ø¨Ø±Ùˆ | Ù…Ù†ØµØ© Ø²Ø¬Ø§Ø¬ÙŠØ© Ù…ØªÙƒØ§Ù…Ù„Ø©</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ›ï¸</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap');
        
        body { 
            font-family: 'Tajawal', sans-serif; 
            /* Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ© ØªØ¹Ø·ÙŠ Ø¬Ù…Ø§Ù„ÙŠØ© Ù„Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠ */
            background: linear-gradient(-45deg, #0f172a, #312e81, #581c87, #1e1b4b);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: #f8fafc;
            min-height: 100vh;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* ÙØ¦Ø§Øª Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠ */
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        
        .glass-panel {
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .glass-input {
            background: rgba(0, 0, 0, 0.2) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            color: white !important;
            transition: all 0.3s ease;
        }
        .glass-input::placeholder { color: rgba(255, 255, 255, 0.5); }
        .glass-input:focus { 
            outline: none; 
            border-color: rgba(167, 139, 250, 0.5) !important; 
            background: rgba(0, 0, 0, 0.4) !important;
            box-shadow: 0 0 15px rgba(167, 139, 250, 0.2);
        }
        
        /* ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ù„ØªÙƒÙˆÙ† Ù…Ù‚Ø±ÙˆØ¡Ø© */
        option { background-color: #1e293b; color: white; }

        .glass-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .glass-btn:hover { 
            background: rgba(255, 255, 255, 0.2); 
            transform: translateY(-2px); 
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .glass-btn-primary {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.8), rgba(168, 85, 247, 0.8));
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .glass-btn-primary:hover {
            background: linear-gradient(135deg, rgba(99, 102, 241, 1), rgba(168, 85, 247, 1));
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.4);
        }

        .hidden-section { display: none !important; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Toasts) */
        #toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 50; display: flex; flex-direction: column; gap: 10px; }
        .toast { padding: 16px 24px; border-radius: 12px; color: white; opacity: 0; transform: translateY(20px); transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
        .toast.show { opacity: 1; transform: translateY(0); }
        .toast-success { background: rgba(16, 185, 129, 0.8); }
        .toast-error { background: rgba(239, 68, 68, 0.8); }
        .toast-info { background: rgba(59, 130, 246, 0.8); }
        
        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†Ø¨Ø¶ Ù„Ù„Ù‚Ù„Ø¨ (Ø§Ù„Ù…ÙØ¶Ù„Ø©) */
        .heart-active { color: #ef4444; fill: #ef4444; animation: heartPulse 0.3s ease; }
        @keyframes heartPulse { 0% { transform: scale(1); } 50% { transform: scale(1.3); } 100% { transform: scale(1); } }
    </style>
</head>
<body class="antialiased">

    <div id="toast-container"></div>

    <div id="edit-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden justify-center items-center z-40 hidden-section flex">
        <div class="glass-panel p-8 rounded-2xl w-full max-w-md mx-4">
            <h3 class="text-2xl font-bold mb-6 text-white text-center">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</h3>
            <form id="edit-product-form" class="space-y-5">
                <input type="hidden" id="edit-prod-id">
                <input type="text" id="edit-prod-name" required class="w-full glass-input rounded-xl px-4 py-3" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
                <textarea id="edit-prod-desc" required class="w-full glass-input rounded-xl px-4 py-3" placeholder="Ø§Ù„ÙˆØµÙ"></textarea>
                <input type="number" id="edit-prod-price" required class="w-full glass-input rounded-xl px-4 py-3" placeholder="Ø§Ù„Ø³Ø¹Ø±">
                <select id="edit-prod-category" class="w-full glass-input rounded-xl px-4 py-3">
                    <option value="Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª">Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</option>
                    <option value="Ù…Ù„Ø§Ø¨Ø³">Ù…Ù„Ø§Ø¨Ø³</option>
                    <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                </select>
                <input type="url" id="edit-prod-image" required class="w-full glass-input rounded-xl px-4 py-3" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©">
                <div class="flex gap-3 pt-2">
                    <button type="submit" class="flex-1 glass-btn-primary text-white py-3 rounded-xl font-bold">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
                    <button type="button" onclick="closeEditModal()" class="flex-1 glass-btn text-white py-3 rounded-xl">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </form>
        </div>
    </div>

    <nav class="glass sticky top-0 z-30 border-b border-white/10">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-black cursor-pointer flex items-center gap-2 text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-indigo-300" onclick="showSection('storefront-section')">
                <svg class="w-7 h-7 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                Ø³ÙˆÙ‚ Ø§Ù„ØªØ¬Ø§Ø± Ø¨Ø±Ùˆ
            </h1>
            <ul class="flex space-x-4 space-x-reverse font-medium items-center">
                <li><button onclick="showSection('storefront-section')" class="hover:text-purple-300 transition px-2">Ø§Ù„Ù…ØªØ¬Ø±</button></li>
                <li><button onclick="showSection('cart-section')" class="hover:text-purple-300 transition flex items-center gap-1 glass px-4 py-1.5 rounded-full">
                    Ø§Ù„Ø³Ù„Ø© <span id="cart-count" class="bg-purple-500 text-white text-xs px-2 py-0.5 rounded-full ml-1">0</span>
                </button></li>
                <li id="nav-dashboard" class="hidden"><button onclick="showSection('dashboard-section')" class="hover:text-purple-300 transition px-2">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button></li>
                <li id="nav-login"><button onclick="showSection('auth-section')" class="glass-btn-primary px-5 py-2 rounded-xl transition">Ø¯Ø®ÙˆÙ„ Ø§Ù„ØªØ§Ø¬Ø±</button></li>
                <li id="nav-logout" class="hidden"><button id="logout-btn" class="text-red-300 hover:text-red-100 transition px-2">Ø®Ø±ÙˆØ¬</button></li>
            </ul>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-10">

        <section id="storefront-section" class="spa-section">
            <div class="glass-panel p-6 rounded-2xl mb-10 flex flex-col md:flex-row justify-between items-center gap-4">
                <h2 class="text-3xl font-bold text-white">ØªØµÙØ­ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
                <div class="flex flex-wrap w-full md:w-auto gap-3">
                    <select id="sort-filter" class="glass-input rounded-xl px-4 py-2 text-sm">
                        <option value="default">Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</option>
                        <option value="price-asc">Ø§Ù„Ø£Ù‚Ù„ Ø³Ø¹Ø±Ø§Ù‹</option>
                        <option value="price-desc">Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø³Ø¹Ø±Ø§Ù‹</option>
                    </select>
                    <select id="category-filter" class="glass-input rounded-xl px-4 py-2 text-sm">
                        <option value="Ø§Ù„ÙƒÙ„">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</option>
                        <option value="Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª">Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</option>
                        <option value="Ù…Ù„Ø§Ø¨Ø³">Ù…Ù„Ø§Ø¨Ø³</option>
                        <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                    </select>
                    <div class="relative w-full md:w-64">
                        <input type="text" id="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..." class="glass-input rounded-xl px-4 py-2 w-full pr-10">
                        <svg class="w-5 h-5 absolute right-3 top-2.5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </div>
                </div>
            </div>
            
            <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
                </div>
        </section>

        <section id="cart-section" class="spa-section hidden-section max-w-4xl mx-auto">
            <h2 class="text-4xl font-black mb-8 text-center text-transparent bg-clip-text bg-gradient-to-r from-purple-200 to-indigo-100">Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h2>
            <div class="glass-panel p-8 rounded-3xl">
                <div id="cart-items" class="divide-y divide-white/10 mb-8 max-h-[50vh] overflow-y-auto pr-2 custom-scrollbar">
                    </div>
                <div class="flex flex-col md:flex-row justify-between items-center border-t border-white/10 pt-8 gap-6">
                    <div>
                        <p class="text-indigo-200 text-sm mb-1">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</p>
                        <span class="text-4xl font-black text-white"><span id="cart-total">0</span> $</span>
                    </div>
                    <button id="checkout-btn" class="glass-btn-primary text-white px-10 py-4 rounded-xl font-bold text-lg shadow-[0_0_15px_rgba(168,85,247,0.5)]">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button>
                </div>
            </div>
        </section>

        <section id="auth-section" class="spa-section hidden-section max-w-md mx-auto mt-12">
            <div class="glass-panel p-10 rounded-3xl relative overflow-hidden">
                <div class="absolute -top-20 -right-20 w-40 h-40 bg-purple-500 rounded-full mix-blend-multiply filter blur-3xl opacity-50"></div>
                
                <h2 id="auth-title" class="text-3xl font-black mb-8 text-center text-white relative z-10">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ØªØ¬Ø§Ø±</h2>
                
                <form id="auth-form" class="space-y-5 relative z-10">
                    <div>
                        <label class="block mb-2 text-sm text-indigo-200 font-medium">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" id="auth-email" required class="w-full glass-input rounded-xl px-4 py-3">
                    </div>
                    <div>
                        <label class="block mb-2 text-sm text-indigo-200 font-medium">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="auth-password" required class="w-full glass-input rounded-xl px-4 py-3">
                    </div>
                    <button type="submit" id="auth-submit" class="w-full glass-btn-primary text-white py-3.5 rounded-xl font-bold text-lg mt-2">Ø¯Ø®ÙˆÙ„</button>
                </form>

                <div class="relative flex items-center py-6 z-10">
                    <div class="flex-grow border-t border-white/20"></div>
                    <span class="flex-shrink-0 mx-4 text-white/50 text-sm">Ø£Ùˆ</span>
                    <div class="flex-grow border-t border-white/20"></div>
                </div>

                <button id="google-auth-btn" class="w-full glass-btn text-white py-3 rounded-xl font-bold flex items-center justify-center gap-3 relative z-10">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                    </svg>
                    Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Google
                </button>

                <div class="mt-6 text-center z-10 relative">
                    <button id="toggle-auth-mode" class="text-sm text-indigo-300 hover:text-white font-medium transition">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø³Ø¬Ù„ ÙƒØªØ§Ø¬Ø± Ø¬Ø¯ÙŠØ¯</button>
                </div>
            </div>
        </section>

        <section id="dashboard-section" class="spa-section hidden-section">
            <div class="glass-panel p-8 rounded-3xl mb-8 flex justify-between items-center">
                <div>
                    <h2 class="text-3xl font-black text-white mb-2">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„ØªØ§Ø¬Ø±</h2>
                    <p class="text-indigo-200">Ø¥Ø¯Ø§Ø±Ø© Ø£Ø¹Ù…Ø§Ù„ÙƒØŒ Ù…Ù†ØªØ¬Ø§ØªÙƒØŒ ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ù…Ø¨ÙŠØ¹Ø§ØªÙƒ Ù„Ø­Ø¸Ø© Ø¨Ù„Ø­Ø¸Ø©</p>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-1 space-y-8">
                    <div class="glass-panel p-6 rounded-2xl">
                        <h3 class="text-xl font-bold mb-6 text-white border-b border-white/10 pb-3 flex items-center gap-2">
                            <svg class="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                            Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
                        </h3>
                        <form id="add-product-form" class="space-y-4">
                            <input type="text" id="prod-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" required class="w-full glass-input rounded-xl px-4 py-3">
                            <select id="prod-category" required class="w-full glass-input rounded-xl px-4 py-3">
                                <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ</option>
                                <option value="Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª">Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</option>
                                <option value="Ù…Ù„Ø§Ø¨Ø³">Ù…Ù„Ø§Ø¨Ø³</option>
                                <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                            </select>
                            <textarea id="prod-desc" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬" required class="w-full glass-input rounded-xl px-4 py-3" rows="3"></textarea>
                            <input type="number" id="prod-price" placeholder="Ø§Ù„Ø³Ø¹Ø± ($)" required class="w-full glass-input rounded-xl px-4 py-3">
                            <input type="url" id="prod-image" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (URL)" required class="w-full glass-input rounded-xl px-4 py-3">
                            <button type="submit" id="add-btn-spinner" class="w-full glass-btn-primary text-white py-3 rounded-xl font-bold mt-2">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬</button>
                        </form>
                    </div>

                    <div class="glass-panel p-6 rounded-2xl">
                        <h3 class="text-xl font-bold mb-4 text-white border-b border-white/10 pb-3">Ù…Ù†ØªØ¬Ø§ØªÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
                        <div class="overflow-y-auto max-h-80 pr-2 custom-scrollbar">
                            <ul id="merchant-products-list" class="divide-y divide-white/10">
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-2">
                    <div class="glass-panel p-6 rounded-2xl h-full">
                        <h3 class="text-2xl font-bold mb-6 text-white border-b border-white/10 pb-3 flex items-center gap-2">
                            <svg class="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path></svg>
                            Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø©
                        </h3>
                        <div class="overflow-x-auto">
                            <table class="w-full text-right text-white">
                                <thead>
                                    <tr class="text-indigo-200 text-sm border-b border-white/20">
                                        <th class="p-4 font-medium">Ø§Ù„Ø¹Ù…ÙŠÙ„ / ID</th>
                                        <th class="p-4 font-medium">Ø§Ù„Ù…Ù†ØªØ¬</th>
                                        <th class="p-4 font-medium">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                        <th class="p-4 font-medium">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                        <th class="p-4 font-medium">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    </tr>
                                </thead>
                                <tbody id="merchant-orders-list" class="text-sm divide-y divide-white/5">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, query, where, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyABI1Q92r_gzgTSd_7nTUz602aX6MafGzw",
            authDomain: "ecommerce-92c76.firebaseapp.com",
            projectId: "ecommerce-92c76",
            storageBucket: "ecommerce-92c76.firebasestorage.app",
            messagingSenderId: "650078282327",
            appId: "1:650078282327:web:e5b9b6c76e174eba0d7912",
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        let currentUser = null;
        let isLoginMode = true;
        let allProductsCache = []; 
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let wishlist = JSON.parse(localStorage.getItem('wishlist')) || []; // Ù…ÙŠØ²Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø©

        // --- Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ---
        window.showToast = (message, type = 'success') => {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerText = message;
            container.appendChild(toast);
            
            requestAnimationFrame(() => {
                setTimeout(() => toast.classList.add('show'), 10);
            });
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        };

        // --- Ø§Ù„ØªÙ†Ù‚Ù„ ---
        window.showSection = (sectionId) => {
            document.querySelectorAll('.spa-section').forEach(sec => sec.classList.add('hidden-section'));
            document.getElementById(sectionId).classList.remove('hidden-section');
            if (sectionId === 'storefront-section') loadAllProducts();
            if (sectionId === 'dashboard-section' && currentUser) {
                loadMerchantProducts();
                loadMerchantOrders();
            }
            if (sectionId === 'cart-section') updateCartUI();
        };

        // --- Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ---
        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            if (user) {
                document.getElementById('nav-dashboard').classList.remove('hidden');
                document.getElementById('nav-logout').classList.remove('hidden');
                document.getElementById('nav-login').classList.add('hidden');
                showSection('dashboard-section');
            } else {
                document.getElementById('nav-dashboard').classList.add('hidden');
                document.getElementById('nav-logout').classList.add('hidden');
                document.getElementById('nav-login').classList.remove('hidden');
                showSection('storefront-section');
            }
        });

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¹Ø§Ø¯ÙŠ
        document.getElementById('toggle-auth-mode').addEventListener('click', () => {
            isLoginMode = !isLoginMode;
            document.getElementById('auth-title').innerText = isLoginMode ? 'Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ØªØ¬Ø§Ø±' : 'Ø­Ø³Ø§Ø¨ ØªØ§Ø¬Ø± Ø¬Ø¯ÙŠØ¯';
            document.getElementById('auth-submit').innerText = isLoginMode ? 'Ø¯Ø®ÙˆÙ„' : 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨';
            document.getElementById('toggle-auth-mode').innerText = isLoginMode ? 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø³Ø¬Ù„ ÙƒØªØ§Ø¬Ø± Ø¬Ø¯ÙŠØ¯' : 'Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ';
        });

        document.getElementById('auth-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            const btn = document.getElementById('auth-submit');
            btn.innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...';

            try {
                if (isLoginMode) {
                    await signInWithEmailAndPassword(auth, email, password);
                    showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­');
                } else {
                    await createUserWithEmailAndPassword(auth, email, password);
                    showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­');
                }
                e.target.reset();
            } catch (error) {
                showToast('Ø®Ø·Ø£: ' + error.message, 'error');
            } finally {
                btn.innerText = isLoginMode ? 'Ø¯Ø®ÙˆÙ„' : 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨';
            }
        });

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¬ÙˆØ¬Ù„ (Ù…ÙŠØ²Ø© Ø¬Ø¯ÙŠØ¯Ø©)
        document.getElementById('google-auth-btn').addEventListener('click', async () => {
            try {
                await signInWithPopup(auth, googleProvider);
                showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨ÙˆØ§Ø³Ø·Ø© Google Ø¨Ù†Ø¬Ø§Ø­');
            } catch (error) {
                showToast('Ø®Ø·Ø£ ÙÙŠ Ù…ØµØ§Ø¯Ù‚Ø© Ø¬ÙˆØ¬Ù„: ' + error.message, 'error');
            }
        });

        document.getElementById('logout-btn').addEventListener('click', async () => {
            await signOut(auth);
            showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'info');
        });

        // --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Ø§Ù„ØªØ§Ø¬Ø±) ---
        document.getElementById('add-product-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('add-btn-spinner');
            btn.innerText = 'Ø¬Ø§Ø±ÙŠ...';
            try {
                await addDoc(collection(db, "products"), {
                    name: document.getElementById('prod-name').value,
                    category: document.getElementById('prod-category').value,
                    description: document.getElementById('prod-desc').value,
                    price: parseFloat(document.getElementById('prod-price').value),
                    imageUrl: document.getElementById('prod-image').value,
                    merchantId: currentUser.uid,
                    createdAt: serverTimestamp()
                });
                showToast('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­');
                e.target.reset();
                loadMerchantProducts();
            } catch (error) {
                showToast('ÙØ´Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©: ' + error.message, 'error');
            } finally {
                btn.innerText = 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬';
            }
        });

        async function loadMerchantProducts() {
            const listEl = document.getElementById('merchant-products-list');
            listEl.innerHTML = '<p class="text-white/50 py-4 text-center">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>';
            try {
                const q = query(collection(db, "products"), where("merchantId", "==", currentUser.uid));
                const snap = await getDocs(q);
                listEl.innerHTML = snap.empty ? '<p class="text-white/50 py-4 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª.</p>' : '';
                snap.forEach((docSnap) => {
                    const data = docSnap.data();
                    const li = document.createElement('li');
                    li.className = 'py-4 flex justify-between items-center group';
                    li.innerHTML = `
                        <div class="flex items-center gap-4">
                            <img src="${data.imageUrl}" class="w-12 h-12 object-cover rounded-xl border border-white/20">
                            <div>
                                <p class="font-bold text-white text-md">${data.name}</p>
                                <p class="text-xs text-purple-300 font-medium mt-1">${data.price} $ â€¢ ${data.category}</p>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="openEditModal('${docSnap.id}', '${data.name}', '${data.description}', ${data.price}, '${data.imageUrl}', '${data.category}')" class="glass-btn px-3 py-1.5 rounded-lg text-sm text-blue-300">ØªØ¹Ø¯ÙŠÙ„</button>
                            <button onclick="deleteProduct('${docSnap.id}')" class="glass-btn px-3 py-1.5 rounded-lg text-sm text-red-300">Ø­Ø°Ù</button>
                        </div>
                    `;
                    listEl.appendChild(li);
                });
            } catch (error) { showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª', 'error'); }
        }

        window.deleteProduct = async (id) => {
            if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ')) {
                try {
                    await deleteDoc(doc(db, "products", id));
                    showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬');
                    loadMerchantProducts();
                } catch (error) { showToast('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù', 'error'); }
            }
        };

        // Modal Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
        window.openEditModal = (id, name, desc, price, img, category) => {
            document.getElementById('edit-prod-id').value = id;
            document.getElementById('edit-prod-name').value = name;
            document.getElementById('edit-prod-desc').value = desc;
            document.getElementById('edit-prod-price').value = price;
            document.getElementById('edit-prod-image').value = img;
            document.getElementById('edit-prod-category').value = category || 'Ø£Ø®Ø±Ù‰';
            document.getElementById('edit-modal').classList.remove('hidden-section');
        };

        window.closeEditModal = () => document.getElementById('edit-modal').classList.add('hidden-section');

        document.getElementById('edit-product-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                await updateDoc(doc(db, "products", document.getElementById('edit-prod-id').value), {
                    name: document.getElementById('edit-prod-name').value,
                    description: document.getElementById('edit-prod-desc').value,
                    price: parseFloat(document.getElementById('edit-prod-price').value),
                    category: document.getElementById('edit-prod-category').value,
                    imageUrl: document.getElementById('edit-prod-image').value
                });
                showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬');
                closeEditModal();
                loadMerchantProducts();
                loadAllProducts(); 
            } catch(error) { showToast('ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'error'); }
        });

        // --- Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Storefront) ---
        async function loadAllProducts() {
            const gridEl = document.getElementById('products-grid');
            gridEl.innerHTML = '<div class="col-span-full flex justify-center py-20"><div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"></div></div>';
            try {
                const snap = await getDocs(collection(db, "products"));
                allProductsCache = []; 
                snap.forEach(doc => allProductsCache.push({ id: doc.id, ...doc.data() }));
                applyFilters(); // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ± ÙˆØ§Ù„ØªØ±ØªÙŠØ¨
            } catch (error) { gridEl.innerHTML = '<p class="text-red-400 text-center col-span-full py-10">ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØ¬Ø±.</p>'; }
        }

        function renderProducts(products) {
            const gridEl = document.getElementById('products-grid');
            gridEl.innerHTML = '';
            if(products.length === 0) {
                gridEl.innerHTML = '<div class="col-span-full text-center py-20 text-white/50 text-xl font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ø¨Ø­Ø«Ùƒ.</div>';
                return;
            }
            products.forEach(data => {
                const isWished = wishlist.includes(data.id);
                const div = document.createElement('div');
                div.className = 'glass rounded-3xl overflow-hidden flex flex-col group relative transition-all duration-500 hover:shadow-[0_0_30px_rgba(168,85,247,0.3)] hover:-translate-y-2';
                div.innerHTML = `
                    <div class="relative overflow-hidden h-64">
                        <img src="${data.imageUrl}" alt="${data.name}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent opacity-60"></div>
                        <span class="absolute top-4 right-4 glass px-3 py-1 rounded-full text-white text-xs font-bold">${data.category}</span>
                        
                        <button onclick="toggleWishlist('${data.id}', this)" class="absolute top-4 left-4 glass p-2 rounded-full text-white hover:bg-white/20 transition z-10">
                            <svg class="w-5 h-5 ${isWished ? 'heart-active' : ''}" fill="${isWished ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>
                        </button>
                    </div>
                    <div class="p-6 flex-grow flex flex-col justify-between relative z-10">
                        <div>
                            <h3 class="font-bold text-xl text-white mb-2 leading-tight">${data.name}</h3>
                            <p class="text-sm text-indigo-200 mb-4 line-clamp-2">${data.description}</p>
                        </div>
                        <div class="flex justify-between items-center mt-2">
                            <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-300 to-indigo-300 font-black text-2xl">${data.price} $</span>
                            <button onclick="addToCart('${data.id}', '${data.name}', ${data.price}, '${data.merchantId}')" class="glass-btn-primary px-5 py-2.5 rounded-xl font-bold text-white text-sm">
                                Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©
                            </button>
                        </div>
                    </div>
                `;
                gridEl.appendChild(div);
            });
        }

        // --- Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©: Ø§Ù„ÙÙ„ØªØ±Ø© ÙˆØ§Ù„ØªØ±ØªÙŠØ¨ ÙˆØ§Ù„Ù…ÙØ¶Ù„Ø© ---
        window.toggleWishlist = (id, btnElement) => {
            const index = wishlist.indexOf(id);
            const svg = btnElement.querySelector('svg');
            if(index > -1) {
                wishlist.splice(index, 1);
                svg.classList.remove('heart-active');
                svg.setAttribute('fill', 'none');
                showToast('ØªÙ…Øª Ø§Ù„Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø©', 'info');
            } else {
                wishlist.push(id);
                svg.classList.add('heart-active');
                svg.setAttribute('fill', 'currentColor');
                showToast('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ÙØ¶Ù„Ø©');
            }
            localStorage.setItem('wishlist', JSON.stringify(wishlist));
        };

        const applyFilters = () => {
            const term = document.getElementById('search-input').value.toLowerCase();
            const category = document.getElementById('category-filter').value;
            const sort = document.getElementById('sort-filter').value;

            let filtered = allProductsCache.filter(prod => {
                const matchName = prod.name.toLowerCase().includes(term);
                const matchCat = category === 'Ø§Ù„ÙƒÙ„' || prod.category === category;
                return matchName && matchCat;
            });

            if (sort === 'price-asc') filtered.sort((a, b) => a.price - b.price);
            if (sort === 'price-desc') filtered.sort((a, b) => b.price - a.price);

            renderProducts(filtered);
        };

        document.getElementById('search-input').addEventListener('input', applyFilters);
        document.getElementById('category-filter').addEventListener('change', applyFilters);
        document.getElementById('sort-filter').addEventListener('change', applyFilters); // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ±ØªÙŠØ¨


        // --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ù„Ø© ---
        window.addToCart = (id, name, price, merchantId) => {
            cart.push({ id, name, price, merchantId });
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartUI();
            showToast(`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${name} Ø¥Ù„Ù‰ Ø³Ù„ØªÙƒ`);
        };

        function updateCartUI() {
            document.getElementById('cart-count').innerText = cart.length;
            const itemsEl = document.getElementById('cart-items');
            itemsEl.innerHTML = '';
            let total = 0;

            if (cart.length === 0) {
                itemsEl.innerHTML = '<div class="text-center py-12 text-white/50"><svg class="w-20 h-20 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg><p class="text-xl">Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ© ØªÙ…Ø§Ù…Ø§Ù‹</p></div>';
            } else {
                cart.forEach((item, index) => {
                    total += item.price;
                    const div = document.createElement('div');
                    div.className = 'py-5 flex justify-between items-center';
                    div.innerHTML = `
                        <div><p class="font-bold text-lg text-white">${item.name}</p></div>
                        <div class="flex items-center gap-6">
                            <span class="font-black text-purple-300 text-xl">${item.price} $</span>
                            <button onclick="removeFromCart(${index})" class="glass p-2.5 rounded-full text-red-400 hover:bg-red-500/20 transition"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button>
                        </div>
                    `;
                    itemsEl.appendChild(div);
                });
            }
            document.getElementById('cart-total').innerText = total.toFixed(2);
        }

        window.removeFromCart = (index) => {
            cart.splice(index, 1);
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartUI();
        };

        // Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨
        document.getElementById('checkout-btn').addEventListener('click', async () => {
            if (cart.length === 0) return showToast('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©', 'error');
            const buyerName = prompt('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ Ù„Ù„ØªÙˆØµÙŠÙ„ (Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©):');
            if (!buyerName) return;
            const btn = document.getElementById('checkout-btn');
            btn.innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ£ÙƒÙŠØ¯...';
            btn.disabled = true;
            try {
                for (const item of cart) {
                    await addDoc(collection(db, "orders"), {
                        buyerName: buyerName, productName: item.name, price: item.price,
                        merchantId: item.merchantId, status: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©',
                        createdAt: serverTimestamp(), orderDate: new Date().toLocaleDateString('ar-EG')
                    });
                }
                showToast('ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ.');
                cart = []; localStorage.setItem('cart', JSON.stringify(cart));
                updateCartUI(); showSection('storefront-section');
            } catch (error) { showToast('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨', 'error');
            } finally { btn.innerText = 'Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†'; btn.disabled = false; }
        });

        // --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª ---
        async function loadMerchantOrders() {
            const tbody = document.getElementById('merchant-orders-list');
            tbody.innerHTML = '<tr><td colspan="5" class="p-6 text-center text-white/50">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</td></tr>';
            try {
                const q = query(collection(db, "orders"), where("merchantId", "==", currentUser.uid));
                const snap = await getDocs(q);
                tbody.innerHTML = snap.empty ? '<tr><td colspan="5" class="p-6 text-center text-white/50">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ø±Ø¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</td></tr>' : '';
                snap.forEach((docSnap) => {
                    const data = docSnap.data();
                    const statusStyles = {
                        'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©': 'bg-yellow-500/20 text-yellow-300 border-yellow-500/30',
                        'ØªÙ… Ø§Ù„Ø´Ø­Ù†': 'bg-blue-500/20 text-blue-300 border-blue-500/30',
                        'Ù…ÙƒØªÙ…Ù„': 'bg-green-500/20 text-green-300 border-green-500/30'
                    };
                    const styling = statusStyles[data.status] || 'bg-white/10 text-white border-white/20';

                    const tr = document.createElement('tr');
                    tr.className = 'border-b border-white/5 hover:bg-white/5 transition-colors';
                    tr.innerHTML = `
                        <td class="p-4"><p class="font-bold text-white">${data.buyerName}</p><p class="text-xs text-white/40 font-mono mt-1">ID: ${docSnap.id.substring(0,6)}</p></td>
                        <td class="p-4 text-indigo-200 font-medium">${data.productName}</td>
                        <td class="p-4 text-purple-300 font-bold">${data.price} $</td>
                        <td class="p-4 text-white/60 text-sm">${data.orderDate}</td>
                        <td class="p-4">
                            <select onchange="updateOrderStatus('${docSnap.id}', this.value)" class="text-sm border rounded-lg px-3 py-1.5 outline-none font-medium backdrop-blur-md ${styling}">
                                <option value="Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©" ${data.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©' ? 'selected' : ''}>Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
                                <option value="ØªÙ… Ø§Ù„Ø´Ø­Ù†" ${data.status === 'ØªÙ… Ø§Ù„Ø´Ø­Ù†' ? 'selected' : ''}>ØªÙ… Ø§Ù„Ø´Ø­Ù†</option>
                                <option value="Ù…ÙƒØªÙ…Ù„" ${data.status === 'Ù…ÙƒØªÙ…Ù„' ? 'selected' : ''}>Ù…ÙƒØªÙ…Ù„</option>
                            </select>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) { tbody.innerHTML = '<tr><td colspan="5" class="p-6 text-center text-red-400">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª.</td></tr>'; }
        }

        window.updateOrderStatus = async (orderId, newStatus) => {
            try {
                await updateDoc(doc(db, "orders", orderId), { status: newStatus });
                showToast(`ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù„Ù€: ${newStatus}`, 'info');
                loadMerchantOrders(); 
            } catch (error) { showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'error'); }
        };

        // Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
        updateCartUI(); 
        loadAllProducts();

    </script>
</body>
</html>
